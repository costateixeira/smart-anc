<?xml version="1.0" encoding="UTF-8"?>

<PlanDefinition xmlns="http://hl7.org/fhir">
  <id value="ANCDT07"/>
  <text>
    <status value="extensions"/><div xmlns="http://www.w3.org/1999/xhtml">
<div>
    <table class="grid dict">
        
        <tr>
            <th scope="row"><b>Id: </b></th>
            <td style="padding-left: 4px;">ANCDT07</td>
        </tr>
        

        
        <tr>
            <th scope="row"><b>Url: </b></th>
            <td style="padding-left: 4px;"><a href="PlanDefinition-ANCDT07.html">ANC.DT.07 Ultrasound recommendation</a></td>
        </tr>
        

        
        <tr>
            <th scope="row"><b>Version: </b></th>
            <td style="padding-left: 4px;">0.3.0</td>
        </tr>
        

        
        <tr>
            <th scope="row">
                <b>
                    
                        Official
                    
                </b>
            </th>
            <td style="padding-left: 4px;">
                
                <p style="margin-bottom: 5px;">
                    <span>ANC.DT.07</span>
                </p>
                
            </td>
        </tr>
        

        
        <tr>
            <th scope="row"><b>Title: </b></th>
            <td style="padding-left: 4px;">ANC.DT.07 Ultrasound recommendation</td>
        </tr>
        

        

        

        

        
        <tr>
            <th scope="row"><b>Type: </b></th>
            <td style="padding-left: 4px;">
                
                    
                        
                        <p style="margin-bottom: 5px;">
                            <b>system: </b> <span><a href="http://terminology.hl7.org/6.4.0/CodeSystem-plan-definition-type.html">http://terminology.hl7.org/CodeSystem/plan-definition-type</a></span>
                        </p>
                        
                        
                        <p style="margin-bottom: 5px;">
                            <b>code: </b> <span>eca-rule</span>
                        </p>
                        
                        
                    
                
                
            </td>
        </tr>
        

        

        
        <tr>
            <th scope="row"><b>Date: </b></th>
            <td style="padding-left: 4px;">2025-06-24 13:58:48-0600</td>
        </tr>
        

        
        <tr>
            <th scope="row"><b>Publisher: </b></th>
            <td style="padding-left: 4px;">World Health Organization (WHO)</td>
        </tr>
        

        
        <tr>
            <th scope="row"><b>Description: </b></th>
            <td style="padding-left: 4px;"><div><p>An ultrasound is recommended for all pregnant women before 24 weeks of gestation (early ultrasound). If there's no ultrasound available at that health-carte facility, the woman should be referred to another facility in which she can receive an ultrasound.</p>
</div></td>
        </tr>
        

        

        

        
        <tr>
            <th scope="row"><b>Use Context: </b></th>
            <td style="padding-left: 4px;">
                <table class="grid-dict">
                    <tr>
                        <th><b>code</b></th>
                        <th><b>value</b></th>
                    </tr>
                    
                        <tr>
                            <td>task</td>
                            <td/>
                        </tr>
                    
                </table>
            </td>
        </tr>
        

        
        <tr>
            <th scope="row"><b>Jurisdiction: </b></th>
            <td style="padding-left: 4px;">001</td>
        </tr>
        

        

        

        

        

        

        

        

        
        <tr>
            <th scope="row"><b>Libraries: </b></th>
            <td style="padding-left: 4px;">
                <table class="grid-dict">
                    
                    <tr>
                        <td><a href="Library-ANCDT07.html">ANC.DT.07 Ultrasound recommendation</a></td>
                    </tr>
                    
                </table>
            </td>
        </tr>
        

        
        <tr>
            <th scope="row"><b>Actions: </b></th>
            <td style="padding-left: 4px;">
                <table class="grid-dict">
                    
                    <tr>
                        <td>
                            
                            <b> ANC.DT.07 Ultrasound recommendation:</b> 
                            
                            <br/>
                            
                            <b>When:</b>
                            
                            <i>Named Event:</i> During woman’s history/profile or lab and imaging tests
                            <br/>
                            
                            
                            
                            
                            <b>Then:</b>
                            <table class="grid-dict">
                                
                                <tr>
                                    <td>
                                        
                                        An ultrasound is recommended for all women before 24 weeks gestation
                                        
                                        <br/>
                                        
                                        
                                        <b>If:</b>
                                        
                                        <i>Applicability:</i>
                                        
                                        &quot;Gestational age&quot; &lt; 24 weeks
                                        
                                        <i>(Should Conduct ultrasound at the health-care facility or the referral facility)</i>
                                        <br/>
                                        
                                        
                                        
                                        
                                        
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td>
                                        
                                        An ultrasound is recommended for all women even after 24 weeks gestation if deemed necessary (e.g. to identify the number of fetuses, fetal presentation or placenta location)
                                        
                                        <br/>
                                        
                                        
                                        <b>If:</b>
                                        
                                        <i>Applicability:</i>
                                        
                                        &quot;Gestational age&quot; ≥ 24 weeks
                                        
                                        <i>(Should Conduct ultrasound at the health-care facility or the referral facility optional if deemed necessary by the health worker)</i>
                                        <br/>
                                        
                                        
                                        
                                        
                                        
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td>
                                        
                                        An ultrasound is recommended for all women before 24 weeks gestation or even after if deemed necessary (e.g. to identify the number of fetuses, fetal presentation or placenta location). 
An early ultrasound is key to estimate gestational age, improve detection of fetal anomalies and multiple fetuses, reduce induction of labour for post-term pregnancy, and improve a woman’s pregnancy experience.
                                        
                                        <br/>
                                        
                                        
                                        <b>If:</b>
                                        
                                        <i>Applicability:</i>
                                        
                                        (&quot;Ultrasound scan conducted&quot; = FALSE)
  AND (&quot;Ultrasound available at the health-care facility&quot; = TRUE)
  AND (&quot;Gestational age&quot; &lt; 24 weeks)
                                        
                                        <i>(Should Conduct ultrasound scan)</i>
                                        <br/>
                                        
                                        
                                        
                                        
                                        
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td>
                                        
                                        If an ultrasound cannot be conducted at the health-care facility, the woman should be referred to another health-care facility in which she can receive an ultrasound. 
An ultrasound is recommended for all women before 24 weeks gestation or even after if deemed necessary (e.g. to identify the number of fetuses, fetal presentation or placenta location). 
An early U/S is key to estimate gestational age, improve detection of fetal anomalies and multiple fetuses, reduce induction of labour for post-term pregnancy, and improve a woman’s pregnancy experience.
                                        
                                        <br/>
                                        
                                        
                                        <b>If:</b>
                                        
                                        <i>Applicability:</i>
                                        
                                        (&quot;Ultrasound scan conducted&quot; = FALSE)
  AND (&quot;Ultrasound available at the health-care facility&quot; = FALSE)
  AND (&quot;Gestational age&quot; &lt; 24 weeks)
                                        
                                        <i>(Should Refer to a facility with ultrasound equipment)</i>
                                        <br/>
                                        
                                        
                                        
                                        
                                        
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td>
                                        
                                        An ultrasound is recommended for all women before 24 weeks gestation or even after if deemed necessary (e.g. to identify the number of fetuses, fetal presentation or placenta location)
                                        
                                        <br/>
                                        
                                        
                                        <b>If:</b>
                                        
                                        <i>Applicability:</i>
                                        
                                        (&quot;Ultrasound scan conducted&quot; = FALSE)
  AND (&quot;Ultrasound available at the health-care facility&quot; = TRUE)
  AND (&quot;Gestational age&quot; ≥ 24 weeks)
                                        
                                        <i>(Should Ultrasound scan is optional)</i>
                                        <br/>
                                        
                                        
                                        
                                        <b>Then:</b> <i>Additional sub-actions not displayed</i>
                                        
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td>
                                        
                                        An ultrasound is recommended for all women before 24 weeks gestation or even after if deemed necessary (e.g. to identify the number of fetuses, fetal presentation or placenta location)
                                        
                                        <br/>
                                        
                                        
                                        <b>If:</b>
                                        
                                        <i>Applicability:</i>
                                        
                                        (&quot;Ultrasound scan conducted&quot; = FALSE)
  AND (&quot;Ultrasound available at the health-care facility&quot; = FALSE)
  AND (&quot;Gestational age&quot; ≥ 24 weeks)
                                        
                                        <i>(Should Ultrasound scan is optional 2)</i>
                                        <br/>
                                        
                                        
                                        
                                        <b>Then:</b> <i>Additional sub-actions not displayed</i>
                                        
                                    </td>
                                </tr>
                                
                            </table>
                            
                        </td>
                    </tr>
                    
                </table>
            </td>
        </tr>
        
    </table>
</div>
</div>
  </text>
  <contained>
    <Library>
      <id value="effective-data-requirements"/>
      <name value="EffectiveDataRequirements"/>
      <status value="active"/>
      <type>
        <coding>
          <system value="http://terminology.hl7.org/CodeSystem/library-type"/>
          <code value="module-definition"/>
        </coding>
      </type>
      <relatedArtifact>
        <type value="depends-on"/>
        <display value="Library FHIRHelpers"/>
        <resource value="http://smart.who.int/anc/Library/FHIRHelpers|4.0.1"/>
      </relatedArtifact>
      <relatedArtifact>
        <type value="depends-on"/>
        <display value="Library ContactData"/>
        <resource value="http://smart.who.int/anc/Library/ANCContactDataElements"/>
      </relatedArtifact>
      <relatedArtifact>
        <type value="depends-on"/>
        <display value="Library WC"/>
        <resource value="http://smart.who.int/anc/Library/WHOCommon"/>
      </relatedArtifact>
      <relatedArtifact>
        <type value="depends-on"/>
        <display value="Library Cx"/>
        <resource value="http://smart.who.int/anc/Library/ANCConcepts"/>
      </relatedArtifact>
      <relatedArtifact>
        <type value="depends-on"/>
        <display value="Library Config"/>
        <resource value="http://smart.who.int/anc/Library/ANCConfig"/>
      </relatedArtifact>
      <relatedArtifact>
        <type value="depends-on"/>
        <display value="Value set Ultrasound done"/>
        <resource value="http://smart.who.int/anc/ValueSet/anc-b6-de15"/>
      </relatedArtifact>
      <relatedArtifact>
        <type value="depends-on"/>
        <display value="Value set Gestational age"/>
        <resource value="http://smart.who.int/anc/ValueSet/anc-b6-de17"/>
      </relatedArtifact>
      <parameter>
        <name value="encounter"/>
        <use value="in"/>
        <min value="0"/>
        <max value="1"/>
        <type value="string"/>
      </parameter>
      <parameter>
        <name value="Should Ultrasound scan is optional"/>
        <use value="out"/>
        <min value="0"/>
        <max value="1"/>
        <type value="boolean"/>
      </parameter>
      <parameter>
        <name value="Should Ultrasound scan is optional 2"/>
        <use value="out"/>
        <min value="0"/>
        <max value="1"/>
        <type value="boolean"/>
      </parameter>
      <parameter>
        <name value="Should Conduct ultrasound at the health-care facility or the referral facility"/>
        <use value="out"/>
        <min value="0"/>
        <max value="1"/>
        <type value="boolean"/>
      </parameter>
      <parameter>
        <name value="Should Conduct ultrasound at the health-care facility or the referral facility optional if deemed necessary by the health worker"/>
        <use value="out"/>
        <min value="0"/>
        <max value="1"/>
        <type value="boolean"/>
      </parameter>
      <parameter>
        <name value="Should Conduct ultrasound scan"/>
        <use value="out"/>
        <min value="0"/>
        <max value="1"/>
        <type value="boolean"/>
      </parameter>
      <parameter>
        <name value="Should Refer to a facility with ultrasound equipment"/>
        <use value="out"/>
        <min value="0"/>
        <max value="1"/>
        <type value="boolean"/>
      </parameter>
      <dataRequirement>
        <type value="Observation"/>
        <profile value="http://hl7.org/fhir/StructureDefinition/Observation"/>
        <mustSupport value="code"/>
        <mustSupport value="status"/>
        <mustSupport value="encounter"/>
        <mustSupport value="encounter.reference"/>
        <codeFilter>
          <path value="code"/>
          <valueSet value="http://smart.who.int/anc/ValueSet/anc-b6-de15"/>
        </codeFilter>
      </dataRequirement>
      <dataRequirement>
        <type value="Observation"/>
        <profile value="http://hl7.org/fhir/StructureDefinition/Observation"/>
        <mustSupport value="code"/>
        <mustSupport value="status"/>
        <mustSupport value="encounter"/>
        <mustSupport value="encounter.reference"/>
        <codeFilter>
          <path value="code"/>
          <valueSet value="http://smart.who.int/anc/ValueSet/anc-b6-de17"/>
        </codeFilter>
      </dataRequirement>
    </Library>
  </contained>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="ANCContactDataElements"/>
    </extension>
    <extension url="name">
      <valueString value="Ultrasound done"/>
    </extension>
    <extension url="statement">
      <valueString value="/*&#xA;  @dataElement: ANC.B6.DE15 Ultrasound done&#xA;  @activity: ANC.B6 Profile&#xA;  @description: Whether or not the woman has had an ultrasound scan done at any point in this pregnancy&#xA;*/&#xA;define &quot;Ultrasound done&quot;:&#xA;  WC.MostRecent(&#xA;  [Observation: Cx.&quot;Ultrasound done&quot;] O&#xA;    where O.status in { 'final', 'amended', 'corrected' }&#xA;      and Coalesce(WC.ModifierExtension(O, 'who-notDone').value, false) is false&#xA;      and Last(Split(O.encounter.reference, '/')) = Last(Split(encounter, '/'))&#xA;  ).value as FHIR.boolean"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="0"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="ANCConfig"/>
    </extension>
    <extension url="name">
      <valueString value="Ultrasound available at the health-care facility"/>
    </extension>
    <extension url="statement">
      <valueString value="/*&#xA;  Description: Is an ultrasound machine available and functional at your&#xA;    facility and a trained health worker available to use it?&#xA;*/&#xA;define &quot;Ultrasound available at the health-care facility&quot;:&#xA;  true"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="1"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="ANCContactDataElements"/>
    </extension>
    <extension url="name">
      <valueString value="Gestational age"/>
    </extension>
    <extension url="statement">
      <valueString value="/*&#xA;  @dataElement: ANC.B6.DE17 Gestational age&#xA;  @activity: ANC.B6 Profile&#xA;  @description: Gestational age in weeks and/or days depending on the source of gestational age&#xA;*/&#xA;define &quot;Gestational age&quot;:&#xA;  WC.MostRecent(&#xA;  [Observation: Cx.&quot;Gestational age&quot;] O&#xA;    where O.status in { 'final', 'amended', 'corrected' }&#xA;      and Coalesce(WC.ModifierExtension(O, 'who-notDone').value, false) is false&#xA;      and Last(Split(O.encounter.reference, '/')) = Last(Split(encounter, '/'))&#xA;  ).value as FHIR.Quantity"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="2"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="ANCDT07"/>
    </extension>
    <extension url="name">
      <valueString value="Should Ultrasound scan is optional"/>
    </extension>
    <extension url="statement">
      <valueString value="/*&#xA;(&quot;Ultrasound scan conducted&quot; = FALSE)&#xA;  AND (&quot;Ultrasound available at the health-care facility&quot; = TRUE)&#xA;  AND (&quot;Gestational age&quot; ≥ 24 weeks)&#xA;*/&#xA;define &quot;Should Ultrasound scan is optional&quot;:&#xA;  ContactData.&quot;Ultrasound done&quot; is false&#xA;    and Config.&quot;Ultrasound available at the health-care facility&quot; = true&#xA;    and ContactData.&quot;Gestational age&quot; &gt;= 24 'weeks'"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="3"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="ANCDT07"/>
    </extension>
    <extension url="name">
      <valueString value="Should Ultrasound scan is optional 2"/>
    </extension>
    <extension url="statement">
      <valueString value="/*&#xA;(&quot;Ultrasound scan conducted&quot; = FALSE)&#xA;  AND (&quot;Ultrasound available at the health-care facility&quot; = FALSE)&#xA;  AND (&quot;Gestational age&quot; ≥ 24 weeks)&#xA;*/&#xA;define &quot;Should Ultrasound scan is optional 2&quot;:&#xA;  ContactData.&quot;Ultrasound done&quot; is false&#xA;    and not Config.&quot;Ultrasound available at the health-care facility&quot; = false&#xA;    and ContactData.&quot;Gestational age&quot; &gt;= 24 'weeks'"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="4"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="ANCDT07"/>
    </extension>
    <extension url="name">
      <valueString value="Should Conduct ultrasound at the health-care facility or the referral facility"/>
    </extension>
    <extension url="statement">
      <valueString value="/*&#xA;&quot;Gestational age&quot; &lt; 24 weeks&#xA;*/&#xA;define &quot;Should Conduct ultrasound at the health-care facility or the referral facility&quot;:&#xA;  ContactData.&quot;Gestational age&quot; &lt; 24 'weeks'"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="5"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="ANCDT07"/>
    </extension>
    <extension url="name">
      <valueString value="Should Conduct ultrasound at the health-care facility or the referral facility optional if deemed necessary by the health worker"/>
    </extension>
    <extension url="statement">
      <valueString value="/*&#xA;&quot;Gestational age&quot; ≥ 24 weeks&#xA;*/&#xA;define &quot;Should Conduct ultrasound at the health-care facility or the referral facility optional if deemed necessary by the health worker&quot;:&#xA;  ContactData.&quot;Gestational age&quot; &gt;= 24 'weeks'"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="6"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="ANCDT07"/>
    </extension>
    <extension url="name">
      <valueString value="Should Conduct ultrasound scan"/>
    </extension>
    <extension url="statement">
      <valueString value="/*&#xA;(&quot;Ultrasound scan conducted&quot; = FALSE)&#xA;  AND (&quot;Ultrasound available at the health-care facility&quot; = TRUE)&#xA;  AND (&quot;Gestational age&quot; &lt; 24 weeks)&#xA;*/&#xA;define &quot;Should Conduct ultrasound scan&quot;:&#xA;  ContactData.&quot;Ultrasound done&quot; is false&#xA;    and Config.&quot;Ultrasound available at the health-care facility&quot; = true&#xA;    and ContactData.&quot;Gestational age&quot; &lt; 24 'weeks'"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="7"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="ANCDT07"/>
    </extension>
    <extension url="name">
      <valueString value="Should Refer to a facility with ultrasound equipment"/>
    </extension>
    <extension url="statement">
      <valueString value="/*&#xA;(&quot;Ultrasound scan conducted&quot; = FALSE)&#xA;  AND (&quot;Ultrasound available at the health-care facility&quot; = FALSE)&#xA;  AND (&quot;Gestational age&quot; &lt; 24 weeks)&#xA;*/&#xA;define &quot;Should Refer to a facility with ultrasound equipment&quot;:&#xA;  ContactData.&quot;Ultrasound done&quot; is false&#xA;    and not Config.&quot;Ultrasound available at the health-care facility&quot; = false&#xA;    and ContactData.&quot;Gestational age&quot; &lt; 24 'weeks'"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="8"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="FHIRHelpers"/>
    </extension>
    <extension url="name">
      <valueString value="ToBoolean"/>
    </extension>
    <extension url="statement">
      <valueString value="define function ToBoolean(value boolean): value.value"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="9"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="WHOCommon"/>
    </extension>
    <extension url="name">
      <valueString value="MostRecent"/>
    </extension>
    <extension url="statement">
      <valueString value="define function MostRecent(observations List&lt;Observation&gt;):&#xA;  Last(&#xA;    observations O&#xA;      sort by issued&#xA;  )"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="10"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="FHIRHelpers"/>
    </extension>
    <extension url="name">
      <valueString value="ToString"/>
    </extension>
    <extension url="statement">
      <valueString value="define function ToString(value ObservationStatus): value.value"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="11"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="WHOCommon"/>
    </extension>
    <extension url="name">
      <valueString value="ModifierExtension"/>
    </extension>
    <extension url="statement">
      <valueString value="/*&#xA;@description: Returns the single WHO core modifier extension (if present) on the given resource with the specified id.&#xA;@comment: This function uses singleton from to ensure that a run-time exception is thrown if there&#xA;is more than one extension on the given resource with the specified url.&#xA;*/&#xA;define function ModifierExtension(domainResource DomainResource, id String):&#xA;  singleton from ModifierExtensions(domainResource, id)"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="12"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="WHOCommon"/>
    </extension>
    <extension url="name">
      <valueString value="ModifierExtensions"/>
    </extension>
    <extension url="statement">
      <valueString value="/*&#xA;@description: Returns any WHO core modifier extensions defined on the given resource with the specified id.&#xA;@comment: NOTE: Extensions are not the preferred approach, but are used as a way to access&#xA;content that is defined by extensions but not yet surfaced in the&#xA;CQL model info.&#xA;*/&#xA;define function ModifierExtensions(domainResource DomainResource, id String):&#xA;  domainResource.modifierExtension E&#xA;&#x9;  where E.url = ('http://fhir.org/guides/who/core/StructureDefinition/' + id)&#xA;&#x9;&#x9;return E"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="13"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="FHIRHelpers"/>
    </extension>
    <extension url="name">
      <valueString value="ToString"/>
    </extension>
    <extension url="statement">
      <valueString value="define function ToString(value uri): value.value"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="14"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="FHIRHelpers"/>
    </extension>
    <extension url="name">
      <valueString value="ToString"/>
    </extension>
    <extension url="statement">
      <valueString value="define function ToString(value string): value.value"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="15"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="FHIRHelpers"/>
    </extension>
    <extension url="name">
      <valueString value="ToQuantity"/>
    </extension>
    <extension url="statement">
      <valueString value="define function ToQuantity(quantity FHIR.Quantity):&#xA;    case&#xA;        when quantity is null then null&#xA;        when quantity.value is null then null&#xA;        when quantity.comparator is not null then&#xA;            Message(null, true, 'FHIRHelpers.ToQuantity.ComparatorQuantityNotSupported', 'Error', 'FHIR Quantity value has a comparator and cannot be converted to a System.Quantity value.')&#xA;        when quantity.system is null or quantity.system.value = 'http://unitsofmeasure.org'&#xA;              or quantity.system.value = 'http://hl7.org/fhirpath/CodeSystem/calendar-units' then&#xA;            System.Quantity { value: quantity.value.value, unit: ToCalendarUnit(Coalesce(quantity.code.value, quantity.unit.value, '1')) }&#xA;        else&#xA;            Message(null, true, 'FHIRHelpers.ToQuantity.InvalidFHIRQuantity', 'Error', 'Invalid FHIR Quantity code: ' &amp; quantity.unit.value &amp; ' (' &amp; quantity.system.value &amp; '|' &amp; quantity.code.value &amp; ')')&#xA;    end"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="16"/>
    </extension>
  </extension>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition">
    <extension url="libraryName">
      <valueString value="FHIRHelpers"/>
    </extension>
    <extension url="name">
      <valueString value="ToCalendarUnit"/>
    </extension>
    <extension url="statement">
      <valueString value="define function ToCalendarUnit(unit System.String):&#xA;    case unit&#xA;        when 'ms' then 'millisecond'&#xA;        when 's' then 'second'&#xA;        when 'min' then 'minute'&#xA;        when 'h' then 'hour'&#xA;        when 'd' then 'day'&#xA;        when 'wk' then 'week'&#xA;        when 'mo' then 'month'&#xA;        when 'a' then 'year'&#xA;        else unit&#xA;    end"/>
    </extension>
    <extension url="displaySequence">
      <valueInteger value="17"/>
    </extension>
  </extension>
  <extension id="effective-data-requirements" url="http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-effectiveDataRequirements">
    <valueCanonical value="#effective-data-requirements"/>
  </extension>
  <extension url="http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-softwaresystem">
    <valueReference>
      <reference value="Device/cqf-tooling"/>
    </valueReference>
  </extension>
  <url value="http://smart.who.int/anc/PlanDefinition/ANCDT07"/>
  <identifier>
    <use value="official"/>
    <value value="ANC.DT.07"/>
  </identifier>
  <version value="0.3.0"/>
  <name value="ANCDT07"/>
  <title value="ANC.DT.07 Ultrasound recommendation"/>
  <type>
    <coding>
      <system value="http://terminology.hl7.org/CodeSystem/plan-definition-type"/>
      <code value="eca-rule"/>
    </coding>
  </type>
  <status value="active"/>
  <experimental value="false"/>
  <date value="2025-06-24T13:58:48-06:00"/>
  <publisher value="World Health Organization (WHO)"/>
  <contact>
    <telecom>
      <system value="url"/>
      <value value="https://www.who.int"/>
    </telecom>
  </contact>
  <description value="An ultrasound is recommended for all pregnant women before 24 weeks of gestation (early ultrasound). If there's no ultrasound available at that health-carte facility, the woman should be referred to another facility in which she can receive an ultrasound."/>
  <useContext>
    <code>
      <system value="http://terminology.hl7.org/CodeSystem/usage-context-type"/>
      <code value="task"/>
      <display value="Workflow Task"/>
    </code>
    <valueCodeableConcept>
      <coding>
        <system value="http://smart.who.int/anc/CodeSystem/activity-codes"/>
        <code value="During"/>
        <display value="woman’s history/profile or lab and imaging tests"/>
      </coding>
    </valueCodeableConcept>
  </useContext>
  <jurisdiction>
    <coding>
      <system value="http://unstats.un.org/unsd/methods/m49/m49.htm"/>
      <code value="001"/>
    </coding>
  </jurisdiction>
  <library value="http://smart.who.int/anc/Library/ANCDT07"/>
  <action>
    <title value="ANC.DT.07 Ultrasound recommendation"/>
    <trigger>
      <type value="named-event"/>
      <name value="During woman’s history/profile or lab and imaging tests"/>
    </trigger>
    <action id="1">
      <title value="Conduct ultrasound at the health-care facility or the referral facility"/>
      <description value="Conduct ultrasound at the health-care facility or the referral facility"/>
      <textEquivalent value="An ultrasound is recommended for all women before 24 weeks gestation"/>
      <documentation>
        <type value="citation"/>
        <label value="WHO ANC recommendations (2016): B.2.4. Ultrasound scan (3)"/>
      </documentation>
      <condition>
        <kind value="applicability"/>
        <expression>
          <description value="&quot;Gestational age&quot; &lt; 24 weeks"/>
          <language value="text/cql-identifier"/>
          <expression value="Should Conduct ultrasound at the health-care facility or the referral facility"/>
        </expression>
      </condition>
    </action>
    <action id="2">
      <title value="Conduct ultrasound at the health-care facility or the referral facility optional if deemed necessary by the health worker"/>
      <description value="Conduct ultrasound at the health-care facility or the referral facility optional if deemed necessary by the health worker"/>
      <textEquivalent value="An ultrasound is recommended for all women even after 24 weeks gestation if deemed necessary (e.g. to identify the number of fetuses, fetal presentation or placenta location)"/>
      <documentation>
        <type value="citation"/>
        <label value="WHO ANC recommendations (2016): B.2.4. Ultrasound scan (3)"/>
      </documentation>
      <condition>
        <kind value="applicability"/>
        <expression>
          <description value="&quot;Gestational age&quot; ≥ 24 weeks"/>
          <language value="text/cql-identifier"/>
          <expression value="Should Conduct ultrasound at the health-care facility or the referral facility optional if deemed necessary by the health worker"/>
        </expression>
      </condition>
    </action>
    <action id="3">
      <title value="Conduct ultrasound scan"/>
      <description value="Conduct ultrasound scan"/>
      <textEquivalent value="An ultrasound is recommended for all women before 24 weeks gestation or even after if deemed necessary (e.g. to identify the number of fetuses, fetal presentation or placenta location). &#xA;An early ultrasound is key to estimate gestational age, improve detection of fetal anomalies and multiple fetuses, reduce induction of labour for post-term pregnancy, and improve a woman’s pregnancy experience."/>
      <documentation>
        <type value="citation"/>
        <label value="WHO ANC recommendations (2016): B.2.4. Ultrasound scan (3)"/>
      </documentation>
      <condition>
        <kind value="applicability"/>
        <expression>
          <description value="(&quot;Ultrasound scan conducted&quot; = FALSE)&#xA;  AND (&quot;Ultrasound available at the health-care facility&quot; = TRUE)&#xA;  AND (&quot;Gestational age&quot; &lt; 24 weeks)"/>
          <language value="text/cql-identifier"/>
          <expression value="Should Conduct ultrasound scan"/>
        </expression>
      </condition>
    </action>
    <action id="4">
      <title value="Refer to a facility with ultrasound equipment"/>
      <description value="Refer to a facility with ultrasound equipment"/>
      <textEquivalent value="If an ultrasound cannot be conducted at the health-care facility, the woman should be referred to another health-care facility in which she can receive an ultrasound. &#xA;An ultrasound is recommended for all women before 24 weeks gestation or even after if deemed necessary (e.g. to identify the number of fetuses, fetal presentation or placenta location). &#xA;An early U/S is key to estimate gestational age, improve detection of fetal anomalies and multiple fetuses, reduce induction of labour for post-term pregnancy, and improve a woman’s pregnancy experience."/>
      <documentation>
        <type value="citation"/>
        <label value="WHO ANC recommendations (2016): B.2.4. Ultrasound scan (3)"/>
      </documentation>
      <condition>
        <kind value="applicability"/>
        <expression>
          <description value="(&quot;Ultrasound scan conducted&quot; = FALSE)&#xA;  AND (&quot;Ultrasound available at the health-care facility&quot; = FALSE)&#xA;  AND (&quot;Gestational age&quot; &lt; 24 weeks)"/>
          <language value="text/cql-identifier"/>
          <expression value="Should Refer to a facility with ultrasound equipment"/>
        </expression>
      </condition>
    </action>
    <action id="5">
      <title value="Ultrasound scan is optional"/>
      <description value="Ultrasound scan is optional"/>
      <textEquivalent value="An ultrasound is recommended for all women before 24 weeks gestation or even after if deemed necessary (e.g. to identify the number of fetuses, fetal presentation or placenta location)"/>
      <documentation>
        <type value="citation"/>
        <label value="WHO ANC recommendations (2016): B.2.4. Ultrasound scan (3)"/>
      </documentation>
      <condition>
        <kind value="applicability"/>
        <expression>
          <description value="(&quot;Ultrasound scan conducted&quot; = FALSE)&#xA;  AND (&quot;Ultrasound available at the health-care facility&quot; = TRUE)&#xA;  AND (&quot;Gestational age&quot; ≥ 24 weeks)"/>
          <language value="text/cql-identifier"/>
          <expression value="Should Ultrasound scan is optional"/>
        </expression>
      </condition>
      <action>
        <title value="Ultrasound scan is optional"/>
      </action>
      <action>
        <title value="Conduct ultrasound if deemed necessary by the health worker"/>
      </action>
    </action>
    <action id="6">
      <title value="Ultrasound scan is optional"/>
      <description value="Ultrasound scan is optional 2"/>
      <textEquivalent value="An ultrasound is recommended for all women before 24 weeks gestation or even after if deemed necessary (e.g. to identify the number of fetuses, fetal presentation or placenta location)"/>
      <documentation>
        <type value="citation"/>
        <label value="WHO ANC recommendations: B.2.4. Ultrasound scan (3)"/>
      </documentation>
      <condition>
        <kind value="applicability"/>
        <expression>
          <description value="(&quot;Ultrasound scan conducted&quot; = FALSE)&#xA;  AND (&quot;Ultrasound available at the health-care facility&quot; = FALSE)&#xA;  AND (&quot;Gestational age&quot; ≥ 24 weeks)"/>
          <language value="text/cql-identifier"/>
          <expression value="Should Ultrasound scan is optional 2"/>
        </expression>
      </condition>
      <action>
        <title value="Ultrasound scan is optional"/>
      </action>
      <action>
        <title value="Refer for ultrasound if deemed necessary by the health worker"/>
      </action>
    </action>
  </action>
</PlanDefinition>