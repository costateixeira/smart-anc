{
  "resourceType": "PlanDefinition",
  "id": "ANCDT36",
  "contained": [ {
    "resourceType": "Library",
    "id": "effective-data-requirements",
    "name": "EffectiveDataRequirements",
    "status": "active",
    "type": {
      "coding": [ {
        "system": "http://terminology.hl7.org/CodeSystem/library-type",
        "code": "module-definition"
      } ]
    },
    "relatedArtifact": [ {
      "type": "depends-on",
      "display": "Library Config",
      "resource": "http://smart.who.int/anc/Library/ANCConfig"
    }, {
      "type": "depends-on",
      "display": "Library ContactData",
      "resource": "http://smart.who.int/anc/Library/ANCContactDataElements"
    }, {
      "type": "depends-on",
      "display": "Library Cx",
      "resource": "http://smart.who.int/anc/Library/ANCConcepts"
    }, {
      "type": "depends-on",
      "display": "Library FHIRHelpers",
      "resource": "http://smart.who.int/anc/Library/FHIRHelpers|4.0.1"
    }, {
      "type": "depends-on",
      "display": "Library WC",
      "resource": "http://smart.who.int/anc/Library/WHOCommon"
    }, {
      "type": "depends-on",
      "display": "Value set Presenting signs and symptoms that trigger suspicion of IPV and clinical inquiry",
      "resource": "http://smart.who.int/anc/ValueSet/anc-b7-de71"
    }, {
      "type": "depends-on",
      "display": "Value set Presenting signs and symptoms that trigger suspicion of IPV and clinical inquiry - Ongoing stress Choices",
      "resource": "http://smart.who.int/anc/ValueSet/anc-b7-de72"
    }, {
      "type": "depends-on",
      "display": "Value set Woman discloses or is suspected to be subjected to intimate partner violence",
      "resource": "http://smart.who.int/anc/ValueSet/anc-b7-de97"
    } ],
    "parameter": [ {
      "name": "encounter",
      "use": "in",
      "min": 0,
      "max": "1",
      "type": "string"
    }, {
      "name": "Should Conduct clinical enquiry and provide first-line support and care if IPV confirmed",
      "use": "out",
      "min": 0,
      "max": "1",
      "type": "boolean"
    }, {
      "name": "Should Conduct clinical enquiry",
      "use": "out",
      "min": 0,
      "max": "1",
      "type": "boolean"
    } ],
    "dataRequirement": [ {
      "type": "Observation",
      "profile": [ "http://hl7.org/fhir/StructureDefinition/Observation" ],
      "mustSupport": [ "code", "status", "encounter", "encounter.reference", "value" ],
      "codeFilter": [ {
        "path": "code",
        "valueSet": "http://smart.who.int/anc/ValueSet/anc-b7-de71"
      } ]
    }, {
      "type": "Observation",
      "profile": [ "http://hl7.org/fhir/StructureDefinition/Observation" ],
      "mustSupport": [ "code", "status", "encounter", "encounter.reference" ],
      "codeFilter": [ {
        "path": "code",
        "valueSet": "http://smart.who.int/anc/ValueSet/anc-b7-de97"
      } ]
    } ]
  } ],
  "extension": [ {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "ANCConfig"
    }, {
      "url": "name",
      "valueString": "Minimum requirements for IPV assessment"
    }, {
      "url": "statement",
      "valueString": "/*\n  Description: \"WHO does not recommend universal screening for violence of\n    women attending health care. WHO does encourage health-care providers\n    to raise the topic with women who have injuries or conditions that they\n    suspect may be related to violence. All of the following must be in\n    place at the health facility for this to be TRUE:\n      a. A protocol or standard operating procedure for intimate partner\n        violence (IPV)\n      b. A health worker trained on how to ask about IPV and how to provide\n        the minimum response or beyond\n      c. A private setting\n      d. A way to ensure confidentiality\n      e. Time to allow for appropriate disclosure AND\n      f. A system for referral in place.\"\n*/\ndefine \"Minimum requirements for IPV assessment\":\n  true"
    }, {
      "url": "displaySequence",
      "valueInteger": 0
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "ANCContactDataElements"
    }, {
      "url": "name",
      "valueString": "Presenting signs and symptoms that trigger suspicion of IPV and clinical inquiry"
    }, {
      "url": "statement",
      "valueString": "/*\n  @dataElement: ANC.B7.DE71 Presenting signs and symptoms that trigger suspicion of IPV and clinical inquiry\n  @activity: ANC.B7 Symptoms & Follow-up\n  @description: Presenting signs and symptoms that trigger clinical enquiry of IPV. The Input Options listed below are based on Health care for women subjected to intimate partner violence or sexual violence – a clinical handbook (3)\n*/\ndefine \"Presenting signs and symptoms that trigger suspicion of IPV and clinical inquiry\":\n  [Observation: Cx.\"Presenting signs and symptoms that trigger suspicion of IPV and clinical inquiry\"] O\n    where O.status in { 'final', 'amended', 'corrected' }\n      and Coalesce(WC.ModifierExtension(O, 'who-notDone').value, false) is false\n      and Last(Split(O.encounter.reference, '/')) = Last(Split(encounter, '/'))\n    return O.value as FHIR.CodeableConcept"
    }, {
      "url": "displaySequence",
      "valueInteger": 1
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "ANCDT36"
    }, {
      "url": "name",
      "valueString": "Should Conduct clinical enquiry and provide first-line support and care if IPV confirmed"
    }, {
      "url": "statement",
      "valueString": "/*\n(Minimum requirements for IPV assessment = TRUE)\n  AND (\"Presenting signs and symptoms that trigger suspicion of IPV and clinical inquiry\" = \"Ongoing stress\")\n*/\ndefine \"Should Conduct clinical enquiry and provide first-line support and care if IPV confirmed\":\n  Config.\"Minimum requirements for IPV assessment\" = true\n    and ContactData.\"Presenting signs and symptoms that trigger suspicion of IPV and clinical inquiry\" in Cx.\"Presenting signs and symptoms that trigger suspicion of IPV and clinical inquiry - Ongoing stress Choices\""
    }, {
      "url": "displaySequence",
      "valueInteger": 2
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "ANCContactDataElements"
    }, {
      "url": "name",
      "valueString": "Woman discloses or is suspected to be subjected to intimate partner violence"
    }, {
      "url": "statement",
      "valueString": "/*\n  @dataElement: ANC.B7.DE97 Woman discloses or is suspected to be subjected to intimate partner violence\n  @activity: ANC.B7 Symptoms & Follow-up\n  @description: Woman discloses or is suspected   to be subjected to intimate partner violence\n*/\ndefine \"Woman discloses or is suspected to be subjected to intimate partner violence\":\n  WC.Only(\n  [Observation: Cx.\"Woman discloses or is suspected to be subjected to intimate partner violence\"] O\n    where O.status in { 'final', 'amended', 'corrected' }\n      and Coalesce(WC.ModifierExtension(O, 'who-notDone').value, false) is false\n      and Last(Split(O.encounter.reference, '/')) = Last(Split(encounter, '/'))\n  ).value as FHIR.boolean"
    }, {
      "url": "displaySequence",
      "valueInteger": 3
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "ANCDT36"
    }, {
      "url": "name",
      "valueString": "Should Conduct clinical enquiry"
    }, {
      "url": "statement",
      "valueString": "/*\n(Minimum requirements for IPV assessment = TRUE\n)\n  AND (Woman discloses or is suspected to be subjected to intimate partner violence = TRUE)\n*/\ndefine \"Should Conduct clinical enquiry\":\n  Config.\"Minimum requirements for IPV assessment\" = true\n    and ContactData.\"Woman discloses or is suspected to be subjected to intimate partner violence\" is true"
    }, {
      "url": "displaySequence",
      "valueInteger": 4
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "FHIRHelpers"
    }, {
      "url": "name",
      "valueString": "ToString"
    }, {
      "url": "statement",
      "valueString": "define function ToString(value ObservationStatus): value.value"
    }, {
      "url": "displaySequence",
      "valueInteger": 5
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "FHIRHelpers"
    }, {
      "url": "name",
      "valueString": "ToBoolean"
    }, {
      "url": "statement",
      "valueString": "define function ToBoolean(value boolean): value.value"
    }, {
      "url": "displaySequence",
      "valueInteger": 6
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "WHOCommon"
    }, {
      "url": "name",
      "valueString": "ModifierExtension"
    }, {
      "url": "statement",
      "valueString": "/*\n@description: Returns the single WHO core modifier extension (if present) on the given resource with the specified id.\n@comment: This function uses singleton from to ensure that a run-time exception is thrown if there\nis more than one extension on the given resource with the specified url.\n*/\ndefine function ModifierExtension(domainResource DomainResource, id String):\n  singleton from ModifierExtensions(domainResource, id)"
    }, {
      "url": "displaySequence",
      "valueInteger": 7
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "WHOCommon"
    }, {
      "url": "name",
      "valueString": "ModifierExtensions"
    }, {
      "url": "statement",
      "valueString": "/*\n@description: Returns any WHO core modifier extensions defined on the given resource with the specified id.\n@comment: NOTE: Extensions are not the preferred approach, but are used as a way to access\ncontent that is defined by extensions but not yet surfaced in the\nCQL model info.\n*/\ndefine function ModifierExtensions(domainResource DomainResource, id String):\n  domainResource.modifierExtension E\n\t  where E.url = ('http://fhir.org/guides/who/core/StructureDefinition/' + id)\n\t\treturn E"
    }, {
      "url": "displaySequence",
      "valueInteger": 8
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "FHIRHelpers"
    }, {
      "url": "name",
      "valueString": "ToString"
    }, {
      "url": "statement",
      "valueString": "define function ToString(value uri): value.value"
    }, {
      "url": "displaySequence",
      "valueInteger": 9
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "FHIRHelpers"
    }, {
      "url": "name",
      "valueString": "ToString"
    }, {
      "url": "statement",
      "valueString": "define function ToString(value string): value.value"
    }, {
      "url": "displaySequence",
      "valueInteger": 10
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "FHIRHelpers"
    }, {
      "url": "name",
      "valueString": "ToConcept"
    }, {
      "url": "statement",
      "valueString": "define function ToConcept(concept FHIR.CodeableConcept):\n    if concept is null then\n        null\n    else\n        System.Concept {\n            codes: concept.coding C return ToCode(C),\n            display: concept.text.value\n        }"
    }, {
      "url": "displaySequence",
      "valueInteger": 11
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "FHIRHelpers"
    }, {
      "url": "name",
      "valueString": "ToCode"
    }, {
      "url": "statement",
      "valueString": "define function ToCode(coding FHIR.Coding):\n    if coding is null then\n        null\n    else\n        System.Code {\n          code: coding.code.value,\n          system: coding.system.value,\n          version: coding.version.value,\n          display: coding.display.value\n        }"
    }, {
      "url": "displaySequence",
      "valueInteger": 12
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "WHOCommon"
    }, {
      "url": "name",
      "valueString": "Only"
    }, {
      "url": "statement",
      "valueString": "define function Only(observations List<Observation>):\n  singleton from observations"
    }, {
      "url": "displaySequence",
      "valueInteger": 13
    } ]
  }, {
    "id": "effective-data-requirements",
    "url": "http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-effectiveDataRequirements",
    "valueCanonical": "#effective-data-requirements"
  }, {
    "url": "http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-softwaresystem",
    "valueReference": {
      "reference": "Device/cqf-tooling"
    }
  } ],
  "url": "http://smart.who.int/anc/PlanDefinition/ANCDT36",
  "identifier": [ {
    "use": "official",
    "value": "ANC.DT.36"
  } ],
  "name": "ANCDT36",
  "title": "ANC.DT.36 Intimate partner violence (IPV) clinical inquiry",
  "type": {
    "coding": [ {
      "system": "http://terminology.hl7.org/CodeSystem/plan-definition-type",
      "code": "eca-rule"
    } ]
  },
  "status": "active",
  "experimental": false,
  "date": "2025-06-24T13:58:48-06:00",
  "description": "You may suspect that a woman has been subjected to intimiate partner violence if she has any of the following risk factors",
  "useContext": [ {
    "code": {
      "system": "http://terminology.hl7.org/CodeSystem/usage-context-type",
      "code": "task",
      "display": "Workflow Task"
    },
    "valueCodeableConcept": {
      "coding": [ {
        "system": "http://smart.who.int/anc/CodeSystem/activity-codes",
        "code": "ANC.B10.8.",
        "display": "Intimate partner violence counselling"
      } ]
    }
  } ],
  "library": [ "http://smart.who.int/anc/Library/ANCDT36" ],
  "action": [ {
    "title": "ANC.DT.36 Intimate partner violence (IPV) clinical inquiry",
    "trigger": [ {
      "type": "named-event",
      "name": "ANC.B10.8. Intimate partner violence counselling"
    } ],
    "action": [ {
      "id": "1",
      "title": "Conduct clinical enquiry",
      "description": "Conduct clinical enquiry",
      "textEquivalent": "Cultures and communities have ways of referring to the problem with other words. It is important to use the words that women themselves use.",
      "documentation": [ {
        "type": "citation",
        "label": "WHO ANC recommendations (2016): B1.3 (2) \n\nIPV handbook (2014) (12)"
      } ],
      "condition": [ {
        "kind": "applicability",
        "expression": {
          "description": "(Minimum requirements for IPV assessment = TRUE\n)\n  AND (Woman discloses or is suspected to be subjected to intimate partner violence = TRUE)",
          "language": "text/cql-identifier",
          "expression": "Should Conduct clinical enquiry"
        }
      } ]
    }, {
      "id": "2",
      "title": "Conduct clinical enquiry and provide first-line support and care if IPV confirmed",
      "description": "Conduct clinical enquiry and provide first-line support and care if IPV confirmed",
      "textEquivalent": "WHO does not recommend universal screening for violence against women attending health care. WHO does encourage health-care providers to raise the topic with women who have injuries or conditions that they suspect may be related to violence.\n\nNever raise the issue of partner violence unless a woman is alone. Even if she is with another woman, that woman could be the mother or sister of an abuser.\n\nIf you do ask her about violence, do it in an empathic, non-judgemental manner. Use language that is appropriate and relevant to the culture and community you are working in. Some women may not like the words “violence” and “abuse”",
      "documentation": [ {
        "type": "citation",
        "label": "IPV handbook (2014) (15)"
      } ],
      "condition": [ {
        "kind": "applicability",
        "expression": {
          "description": "(Minimum requirements for IPV assessment = TRUE)\n  AND (\"Presenting signs and symptoms that trigger suspicion of IPV and clinical inquiry\" = \"Ongoing stress\")",
          "language": "text/cql-identifier",
          "expression": "Should Conduct clinical enquiry and provide first-line support and care if IPV confirmed"
        }
      } ]
    } ]
  } ]
}