{
  "resourceType": "PlanDefinition",
  "id": "ANCDT05",
  "contained": [ {
    "resourceType": "Library",
    "id": "effective-data-requirements",
    "name": "EffectiveDataRequirements",
    "status": "active",
    "type": {
      "coding": [ {
        "system": "http://terminology.hl7.org/CodeSystem/library-type",
        "code": "module-definition"
      } ]
    },
    "relatedArtifact": [ {
      "type": "depends-on",
      "display": "Library FHIRHelpers",
      "resource": "http://smart.who.int/anc/Library/FHIRHelpers|4.0.1"
    }, {
      "type": "depends-on",
      "display": "Library ContactData",
      "resource": "http://smart.who.int/anc/Library/ANCContactDataElements"
    }, {
      "type": "depends-on",
      "display": "Library WC",
      "resource": "http://smart.who.int/anc/Library/WHOCommon"
    }, {
      "type": "depends-on",
      "display": "Library Cx",
      "resource": "http://smart.who.int/anc/Library/ANCConcepts"
    }, {
      "type": "depends-on",
      "display": "Value set Cervical dilation",
      "resource": "http://smart.who.int/anc/ValueSet/anc-b8-de93"
    }, {
      "type": "depends-on",
      "display": "Value set Gestational age",
      "resource": "http://smart.who.int/anc/ValueSet/anc-b6-de17"
    } ],
    "parameter": [ {
      "name": "encounter",
      "use": "in",
      "min": 0,
      "max": "1",
      "type": "string"
    }, {
      "name": "Should Evaluate labour < 37 week",
      "use": "out",
      "min": 0,
      "max": "1",
      "type": "boolean"
    }, {
      "name": "Should Evaluate labour > 37 weeks",
      "use": "out",
      "min": 0,
      "max": "1",
      "type": "boolean"
    } ],
    "dataRequirement": [ {
      "type": "Observation",
      "profile": [ "http://hl7.org/fhir/StructureDefinition/Observation" ],
      "mustSupport": [ "code", "status", "encounter", "encounter.reference" ],
      "codeFilter": [ {
        "path": "code",
        "valueSet": "http://smart.who.int/anc/ValueSet/anc-b8-de93"
      } ]
    }, {
      "type": "Observation",
      "profile": [ "http://hl7.org/fhir/StructureDefinition/Observation" ],
      "mustSupport": [ "code", "status", "encounter", "encounter.reference" ],
      "codeFilter": [ {
        "path": "code",
        "valueSet": "http://smart.who.int/anc/ValueSet/anc-b6-de17"
      } ]
    } ]
  } ],
  "extension": [ {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "ANCContactDataElements"
    }, {
      "url": "name",
      "valueString": "Cervical dilation"
    }, {
      "url": "statement",
      "valueString": "/*\n  @dataElement: ANC.B8.DE93 Cervical dilation\n  @activity: ANC.B8 Physical exam\n  @description: If a cervical exam was done, how many centimeters is the cervix dilated?\n*/\ndefine \"Cervical dilation\":\n  WC.Only(\n  [Observation: Cx.\"Cervical dilation\"] O\n    where O.status in { 'final', 'amended', 'corrected' }\n      and Coalesce(WC.ModifierExtension(O, 'who-notDone').value, false) is false\n      and Last(Split(O.encounter.reference, '/')) = Last(Split(encounter, '/'))\n  ).value as FHIR.Quantity"
    }, {
      "url": "displaySequence",
      "valueInteger": 0
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "ANCContactDataElements"
    }, {
      "url": "name",
      "valueString": "Gestational age"
    }, {
      "url": "statement",
      "valueString": "/*\n  @dataElement: ANC.B6.DE17 Gestational age\n  @activity: ANC.B6 Profile\n  @description: Gestational age in weeks and/or days depending on the source of gestational age\n*/\ndefine \"Gestational age\":\n  WC.MostRecent(\n  [Observation: Cx.\"Gestational age\"] O\n    where O.status in { 'final', 'amended', 'corrected' }\n      and Coalesce(WC.ModifierExtension(O, 'who-notDone').value, false) is false\n      and Last(Split(O.encounter.reference, '/')) = Last(Split(encounter, '/'))\n  ).value as FHIR.Quantity"
    }, {
      "url": "displaySequence",
      "valueInteger": 1
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "ANCDT05"
    }, {
      "url": "name",
      "valueString": "Should Evaluate labour < 37 week"
    }, {
      "url": "statement",
      "valueString": "/*\n(\"Cervical dilation\" > 2cm)\n  AND (\"Gestational age\" < 37 weeks)\n*/\ndefine \"Should Evaluate labour < 37 week\":\n  ContactData.\"Cervical dilation\" > 2 'cm'\n    and ContactData.\"Gestational age\" < 37 'weeks'"
    }, {
      "url": "displaySequence",
      "valueInteger": 2
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "ANCDT05"
    }, {
      "url": "name",
      "valueString": "Should Evaluate labour > 37 weeks"
    }, {
      "url": "statement",
      "valueString": "/*\n(\"Cervical dilation\" > 2 cm)\n  AND (\"Gestational age\" > 37 weeks)\n*/\ndefine \"Should Evaluate labour > 37 weeks\":\n  ContactData.\"Cervical dilation\" > 2 'cm'\n    and ContactData.\"Gestational age\" >= 37 'weeks'"
    }, {
      "url": "displaySequence",
      "valueInteger": 3
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "FHIRHelpers"
    }, {
      "url": "name",
      "valueString": "ToQuantity"
    }, {
      "url": "statement",
      "valueString": "define function ToQuantity(quantity FHIR.Quantity):\n    case\n        when quantity is null then null\n        when quantity.value is null then null\n        when quantity.comparator is not null then\n            Message(null, true, 'FHIRHelpers.ToQuantity.ComparatorQuantityNotSupported', 'Error', 'FHIR Quantity value has a comparator and cannot be converted to a System.Quantity value.')\n        when quantity.system is null or quantity.system.value = 'http://unitsofmeasure.org'\n              or quantity.system.value = 'http://hl7.org/fhirpath/CodeSystem/calendar-units' then\n            System.Quantity { value: quantity.value.value, unit: ToCalendarUnit(Coalesce(quantity.code.value, quantity.unit.value, '1')) }\n        else\n            Message(null, true, 'FHIRHelpers.ToQuantity.InvalidFHIRQuantity', 'Error', 'Invalid FHIR Quantity code: ' & quantity.unit.value & ' (' & quantity.system.value & '|' & quantity.code.value & ')')\n    end"
    }, {
      "url": "displaySequence",
      "valueInteger": 4
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "FHIRHelpers"
    }, {
      "url": "name",
      "valueString": "ToCalendarUnit"
    }, {
      "url": "statement",
      "valueString": "define function ToCalendarUnit(unit System.String):\n    case unit\n        when 'ms' then 'millisecond'\n        when 's' then 'second'\n        when 'min' then 'minute'\n        when 'h' then 'hour'\n        when 'd' then 'day'\n        when 'wk' then 'week'\n        when 'mo' then 'month'\n        when 'a' then 'year'\n        else unit\n    end"
    }, {
      "url": "displaySequence",
      "valueInteger": 5
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "WHOCommon"
    }, {
      "url": "name",
      "valueString": "Only"
    }, {
      "url": "statement",
      "valueString": "define function Only(observations List<Observation>):\n  singleton from observations"
    }, {
      "url": "displaySequence",
      "valueInteger": 6
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "FHIRHelpers"
    }, {
      "url": "name",
      "valueString": "ToString"
    }, {
      "url": "statement",
      "valueString": "define function ToString(value ObservationStatus): value.value"
    }, {
      "url": "displaySequence",
      "valueInteger": 7
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "FHIRHelpers"
    }, {
      "url": "name",
      "valueString": "ToBoolean"
    }, {
      "url": "statement",
      "valueString": "define function ToBoolean(value boolean): value.value"
    }, {
      "url": "displaySequence",
      "valueInteger": 8
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "WHOCommon"
    }, {
      "url": "name",
      "valueString": "ModifierExtension"
    }, {
      "url": "statement",
      "valueString": "/*\n@description: Returns the single WHO core modifier extension (if present) on the given resource with the specified id.\n@comment: This function uses singleton from to ensure that a run-time exception is thrown if there\nis more than one extension on the given resource with the specified url.\n*/\ndefine function ModifierExtension(domainResource DomainResource, id String):\n  singleton from ModifierExtensions(domainResource, id)"
    }, {
      "url": "displaySequence",
      "valueInteger": 9
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "WHOCommon"
    }, {
      "url": "name",
      "valueString": "ModifierExtensions"
    }, {
      "url": "statement",
      "valueString": "/*\n@description: Returns any WHO core modifier extensions defined on the given resource with the specified id.\n@comment: NOTE: Extensions are not the preferred approach, but are used as a way to access\ncontent that is defined by extensions but not yet surfaced in the\nCQL model info.\n*/\ndefine function ModifierExtensions(domainResource DomainResource, id String):\n  domainResource.modifierExtension E\n\t  where E.url = ('http://fhir.org/guides/who/core/StructureDefinition/' + id)\n\t\treturn E"
    }, {
      "url": "displaySequence",
      "valueInteger": 10
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "FHIRHelpers"
    }, {
      "url": "name",
      "valueString": "ToString"
    }, {
      "url": "statement",
      "valueString": "define function ToString(value uri): value.value"
    }, {
      "url": "displaySequence",
      "valueInteger": 11
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "FHIRHelpers"
    }, {
      "url": "name",
      "valueString": "ToString"
    }, {
      "url": "statement",
      "valueString": "define function ToString(value string): value.value"
    }, {
      "url": "displaySequence",
      "valueInteger": 12
    } ]
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-logicDefinition",
    "extension": [ {
      "url": "libraryName",
      "valueString": "WHOCommon"
    }, {
      "url": "name",
      "valueString": "MostRecent"
    }, {
      "url": "statement",
      "valueString": "define function MostRecent(observations List<Observation>):\n  Last(\n    observations O\n      sort by issued\n  )"
    }, {
      "url": "displaySequence",
      "valueInteger": 13
    } ]
  }, {
    "id": "effective-data-requirements",
    "url": "http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-effectiveDataRequirements",
    "valueCanonical": "#effective-data-requirements"
  }, {
    "url": "http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-softwaresystem",
    "valueReference": {
      "reference": "Device/cqf-tooling"
    }
  } ],
  "url": "http://smart.who.int/anc/PlanDefinition/ANCDT05",
  "identifier": [ {
    "use": "official",
    "value": "ANC.DT.05"
  } ],
  "name": "ANCDT05",
  "title": "ANC.DT.05 Evaluating labour",
  "type": {
    "coding": [ {
      "system": "http://terminology.hl7.org/CodeSystem/plan-definition-type",
      "code": "eca-rule"
    } ]
  },
  "status": "active",
  "experimental": false,
  "date": "2025-06-24T13:58:48-06:00",
  "description": "During a cervical exam, if cervical dilation is greater than 2 cm evaluate the possibility of labour",
  "useContext": [ {
    "code": {
      "system": "http://terminology.hl7.org/CodeSystem/usage-context-type",
      "code": "task",
      "display": "Workflow Task"
    },
    "valueCodeableConcept": {
      "coding": [ {
        "system": "http://smart.who.int/anc/CodeSystem/activity-codes",
        "code": "ANC.B8",
        "display": "Conduct physical exam"
      } ]
    }
  } ],
  "library": [ "http://smart.who.int/anc/Library/ANCDT05" ],
  "action": [ {
    "title": "ANC.DT.05 Evaluating labour",
    "trigger": [ {
      "type": "named-event",
      "name": "ANC.B8 Conduct physical exam"
    } ],
    "action": [ {
      "id": "1",
      "title": "Evaluate labour > 37 weeks",
      "description": "Evaluate labour > 37 weeks",
      "textEquivalent": "Cervix is more than 2 cm dilated: check for other signs and symptoms of labour (if GA is 37 weeks or later)",
      "documentation": [ {
        "type": "citation",
        "label": "Pregnancy, childbirth, postpartum and newborn care guide (IMPAC) (2015) (1)"
      } ],
      "condition": [ {
        "kind": "applicability",
        "expression": {
          "description": "(\"Cervical dilation\" > 2 cm)\n  AND (\"Gestational age\" > 37 weeks)",
          "language": "text/cql-identifier",
          "expression": "Should Evaluate labour > 37 weeks"
        }
      } ]
    }, {
      "id": "2",
      "title": "Evaluate labour < 37 week",
      "description": "Evaluate labour < 37 week",
      "textEquivalent": "Cervix is more than 2 cm dilated: check for other signs and symptoms of pre-term labour and other related complications (if GA is less than 37 weeks)",
      "documentation": [ {
        "type": "citation",
        "label": "Pregnancy, childbirth, postpartum and newborn care guide (IMPAC) (2015) (1)"
      } ],
      "condition": [ {
        "kind": "applicability",
        "expression": {
          "description": "(\"Cervical dilation\" > 2cm)\n  AND (\"Gestational age\" < 37 weeks)",
          "language": "text/cql-identifier",
          "expression": "Should Evaluate labour < 37 week"
        }
      } ]
    } ]
  } ]
}